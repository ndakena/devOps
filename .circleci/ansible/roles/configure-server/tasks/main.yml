--- 
- name: "configuration play."
  hosts: '*'
  roles:
   - configure-server
- name: 'user definition'
  user: ubuntu
  gather_facts: false
  vars:
    - ansible_python_interpreter: /usr/bin/python3
    - ansible_host_key_checking: false
    - ansible_stdout_callback: yaml

  pre_tasks:
    - name: "wait 600 seconds for target connection to become reachable/usable."
      wait_for_connection:

    - name: "install python for Ansible."
      become: true
      raw: test -e /usr/bin/python3 || (apt -y update && apt install -y python3)
      changed_when: false

- 
  apt: 
    upgrade: "yes"
  become: true
  name: "upgrade packages."
- 
  apt: 
    name: 
      - nodejs
      - npm
    state: latest
    update_cache: true
  become: true
  name: "install dependencies."
- 
  become: true
  name: "install pm2"
  npm: 
    global: true
    name: pm2
    production: true
    state: present
- 
  git: 
    dest: /src/project
    repo: "https://github.com/ndakena/Give-your-app-supper-powers.git"
    version: master
  name: "Clone git repo"
- 
  name: "Run backend"
  shell: "cd /src/project/backend &&  npm i && pm2 startup && pm2 start npm --name \"backend\" -- start"
