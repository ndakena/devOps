--- 

- name: Install 
  hosts: "webservers"
  become: yes
  become_user: root
  gather_facts: false
  tasks:

    - debug: var=ansible_host

    - name: run as root - update, install python, ...

      ignore_errors: true

      raw: "{{ item }}"

      loop:

        - touch /root/ansible-apt-update

        - apt -y update

        - apt -y upgrade

        - apt install -y python

        - apt install -y prometheus

        - apt install -y prometheus-node-exporter

- name: Install 

  # hosts: "*"

  hosts: "aws_ubuntu"

  become: yes

  become_user: root

  gather_facts: false

  tasks:

    - debug: var=ansible_host

    - name: run as root - update, install python, ...

      ignore_errors: true

      raw: "{{ item }}"

      loop:

        - touch /root/ansible-apt-update

        - apt -y update

        - apt -y upgrade

        - apt install -y python

        - apt install -y prometheus

        - apt install -y prometheus-node-exporter

- name: Install 

  # hosts: "*"

  hosts: "aws_ubuntu"

  become: yes

  become_user: root

  gather_facts: false

  tasks:

    - debug: var=ansible_host

    - name: run as root - update, install python, ...

      ignore_errors: true

      raw: "{{ item }}"

      loop:

        - touch /root/ansible-apt-update

        - apt -y update

        - apt -y upgrade

        - apt install -y python

        - apt install -y prometheus

        - apt install -y prometheus-node-exporter

- name: Install 

  # hosts: "*"

  hosts: "aws_ubuntu"

  become: yes

  become_user: root

  gather_facts: false

  tasks:

    - debug: var=ansible_host

    - name: run as root - update, install python, ...

      ignore_errors: true

      raw: "{{ item }}"

      loop:

        - touch /root/ansible-apt-update

        - apt -y update

        - apt -y upgrade

        - apt install -y python

        - apt install -y prometheus

        - apt install -y prometheus-node-exporter

- name: "upgrade packages"
  become: yes
  apt:
   upgrade: yes

- name: remove dependencies that are no longer required
  become: yes
  apt:
    autoremove: yes

- name: "install dependencies."
  become: yes
  apt:
    name: ["nodejs", "npm"]
    state: latest
    update_cache: yes
- name: "Clone git repo"
  git: 
    dest: /src/project
    repo: "https://github.com/ndakena/Give-your-app-supper-powers.git"
    version: master

- name: "Run backend"
  shell: "cd /src/project/backend &&  npm i && pm2 startup && pm2 start npm --name \"backend\" -- start"
